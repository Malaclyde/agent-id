---
phase: 32-bug-discovery
plan: 02
type: execute
wave: 2
depends_on: ["32-01"]
files_modified:
  - .planning/phases/32-bug-discovery/BUG-REPORT.md
autonomous: false

must_haves:
  truths:
    - "Every test failure is classified as application bug, test bug, or known limitation"
    - "User can review a comprehensive bug report organized by subsystem and severity"
    - "User has discussed the bug report before any fixes are applied"
  artifacts:
    - path: ".planning/phases/32-bug-discovery/BUG-REPORT.md"
      provides: "Comprehensive bug report with classified failures, severity ratings, and reproduction details"
      contains: "## Summary"
  key_links:
    - from: ".planning/phases/32-bug-discovery/test-results/backend-results.txt"
      to: ".planning/phases/32-bug-discovery/BUG-REPORT.md"
      via: "failure analysis and classification"
      pattern: "Backend"
    - from: ".planning/phases/32-bug-discovery/test-results/frontend-results.txt"
      to: ".planning/phases/32-bug-discovery/BUG-REPORT.md"
      via: "failure analysis and classification"
      pattern: "Frontend"
    - from: ".planning/phases/32-bug-discovery/test-results/e2e-results.txt"
      to: ".planning/phases/32-bug-discovery/BUG-REPORT.md"
      via: "failure analysis and classification"
      pattern: "E2E"
---

<objective>
Analyze all test results, classify every failure, and produce a comprehensive bug report for user discussion.

Purpose: Satisfy BUGS-01 (identify bugs) and BUGS-02 (report and discuss before fixing). Transform raw test output into an actionable, classified bug report.
Output: BUG-REPORT.md with severity-rated, classified failures ready for user triage.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-bug-discovery/32-CONTEXT.md
@.planning/phases/32-bug-discovery/32-01-SUMMARY.md
@.planning/phases/32-bug-discovery/test-results/backend-results.txt
@.planning/phases/32-bug-discovery/test-results/frontend-results.txt
@.planning/phases/32-bug-discovery/test-results/e2e-results.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze failures and produce BUG-REPORT.md</name>
  <files>.planning/phases/32-bug-discovery/BUG-REPORT.md</files>
  <action>
    Read all three test result files from `.planning/phases/32-bug-discovery/test-results/`.

    For EACH test failure, investigate the source code to determine root cause. Read the failing test file AND the application code it exercises. Classify each failure into one of three categories:

    **Classification rules:**
    - **Application Bug** — The test is correct but the application code has a defect. The test reveals real broken behavior.
    - **Test Bug** — The application code is correct but the test has a bad assertion, incorrect setup, stale mock, or wrong expectation.
    - **Known Limitation** — A failure that was previously acknowledged. Per STATE.md: 3 backend unit tests were skipped in Phase 29 (29-12-D01: "skipped 3 unit tests requiring subscription mocking — covered by integration tests"). These are known limitations, not new bugs.

    **For each classified failure, record:**
    - Test name and file path
    - Subsystem: Backend / Frontend / E2E
    - Feature area: auth, subscriptions, Paddle, clients, agents, OAuth, shadow-claim, etc.
    - Classification: Application Bug / Test Bug / Known Limitation
    - Severity (for application bugs only): Critical / High / Medium / Low
      - Critical: Breaks core flow (auth, subscription activation, payment)
      - High: Feature doesn't work as documented but has workaround
      - Medium: Edge case failure, non-blocking
      - Low: Cosmetic or minor inconsistency
    - Failure output (error message, expected vs actual)
    - Root cause analysis (1-2 sentences explaining WHY it fails)

    **Also record passing test counts** per subsystem for the summary table.

    **Produce BUG-REPORT.md** with this structure:

    ```markdown
    # Bug Discovery Report — Agent-ID Platform

    **Generated:** [date]
    **Test Suites:** Backend (vitest), Frontend (vitest), E2E (Playwright)

    ## Summary

    | Subsystem | Total | Pass | Fail | Skip | App Bugs | Test Bugs | Known |
    |-----------|-------|------|------|------|----------|-----------|-------|
    | Backend   | N     | N    | N    | N    | N        | N         | N     |
    | Frontend  | N     | N    | N    | N    | N        | N         | N     |
    | E2E       | N     | N    | N    | N    | N        | N         | N     |
    | **Total** | N     | N    | N    | N    | N        | N         | N     |

    ## Application Bugs

    ### Critical
    [bugs or "None"]

    ### High
    [bugs or "None"]

    ### Medium
    [bugs or "None"]

    ### Low
    [bugs or "None"]

    ## Test Bugs
    [classified test issues]

    ## Known Limitations
    [acknowledged skips and known failures]
    ```

    Each bug entry uses this format:
    ```markdown
    #### BUG-NNN: [Short description]
    - **Test:** `test name` in `file/path.test.ts`
    - **Subsystem:** Backend / Frontend / E2E
    - **Feature:** [area]
    - **Error:** [failure message]
    - **Expected:** [what should happen]
    - **Actual:** [what happens instead]
    - **Root Cause:** [1-2 sentence analysis]
    ```

    Do NOT suggest fixes in the report. This is discovery only.
  </action>
  <verify>
    - `.planning/phases/32-bug-discovery/BUG-REPORT.md` exists
    - Report contains Summary table with counts
    - Every failure from the three result files is accounted for (classified)
    - Application bugs have severity ratings
    - Each entry has test name, file path, error, and root cause
  </verify>
  <done>Comprehensive bug report produced with every test failure classified, severity-rated, and root-cause-analyzed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete bug discovery report analyzing all test suite results across backend, frontend, and E2E.
    Every failure has been classified (application bug / test bug / known limitation) with severity ratings and root cause analysis.
  </what-built>
  <how-to-verify>
    1. Review `.planning/phases/32-bug-discovery/BUG-REPORT.md`
    2. Check the summary table for overall counts
    3. Review application bugs by severity — do the classifications and severity ratings seem accurate?
    4. Review test bugs — are these genuinely test issues, not app issues?
    5. Review known limitations — are these correctly identified as pre-existing?
    6. Decide: Which bugs should be fixed? Which should be deferred? Any reclassifications needed?
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 32, or provide feedback on reclassifications / priorities</resume-signal>
</task>

</tasks>

<verification>
- BUG-REPORT.md exists with complete analysis
- Every test failure across all three suites is accounted for
- Classification distinguishes app bugs from test bugs from known limitations
- Application bugs have severity ratings (Critical/High/Medium/Low)
- User has reviewed and discussed the report (BUGS-02)
</verification>

<success_criteria>
- All test failures from Plan 01 results are classified in the report
- Report is organized by subsystem and severity per CONTEXT.md decisions
- User has reviewed the report and provided triage decisions
- No code fixes have been applied (discovery only)
</success_criteria>

<output>
After completion, create `.planning/phases/32-bug-discovery/32-02-SUMMARY.md`
</output>
