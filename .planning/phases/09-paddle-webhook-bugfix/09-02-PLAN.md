---
phase: 09-paddle-webhook-bugfix
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [backend/src/routes/webhooks.ts, docs/v1/endpoints/webhooks.md, docs/v1/endpoints/subscriptions.md, docs/v1/test scenarios/subscription.md, docs/v1/requirements/overseer/user-stories.md]
autonomous: true

must_haves:
  truths:
    - "Cancellation webhooks are now handled correctly"
    - "Event name uses 'subscription.canceled' (single L)"
    - "Subscription cancellation deactivates oversights"
    - "Documentation reflects correct event spelling"
  artifacts:
    - path: "backend/src/routes/webhooks.ts"
      provides: "Correct event handler for cancellation"
      contains: "case 'subscription.canceled':"
      not_contains: "subscription.cancelled"
    - path: "docs/v1/endpoints/webhooks.md"
      provides: "Correct event name in documentation"
      contains: "subscription.canceled"
      not_contains: "subscription.cancelled"
    - path: "docs/v1/endpoints/subscriptions.md"
      provides: "Correct event name in documentation"
      contains: "subscription.canceled"
      not_contains: "subscription.cancelled"
    - path: "docs/v1/test scenarios/subscription.md"
      provides: "Correct event name in test scenarios"
      contains: "subscription.canceled"
      not_contains: "subscription.cancelled"
    - path: "docs/v1/requirements/overseer/user-stories.md"
      provides: "Correct event name in user stories"
      contains: "subscription.canceled"
      not_contains: "subscription.cancelled"
  key_links:
    - from: "backend/src/routes/webhooks.ts"
      to: "backend/src/services/webhook-handler.ts"
      via: "handleSubscriptionCancellation call"
      pattern: "handleSubscriptionCancellation"
---

<objective>
Fix the event name spelling error that prevents cancellation webhooks from being processed.

Purpose: This is Priority 2 - the current code uses `subscription.cancelled` (double 'L') but Paddle's official event is `subscription.canceled` (single 'L'). This means all cancellation events fall through to the default case and are only logged, never processed. As a result, oversights remain active even when subscriptions are canceled, granting access to non-paying users. Additionally, all documentation files must be updated to reflect the correct spelling.

Output: Corrected event handler in webhooks.ts that processes `subscription.canceled` events, with all documentation files updated to use the correct spelling.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/phases/09-paddle-webhook-bugfix/09-RESEARCH.md

@backend/src/routes/webhooks.ts
@backend/src/services/webhook-handler.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix event name spelling in webhooks.ts</name>
  <files>backend/src/routes/webhooks.ts</files>
  <action>
    Change line 126 from:
    ```typescript
    case 'subscription.cancelled':
    ```
    
    To:
    ```typescript
    case 'subscription.canceled':
    ```
    
    This fixes the critical bug where cancellation webhooks are never handled because the event name doesn't match Paddle's official event name. Paddle's documentation confirms the correct spelling is `subscription.canceled` (single 'L'): https://developer.paddle.com/webhooks/subscriptions/subscription-canceled
    
    Do NOT change anything else in this file. All other event handlers and code are correct.
  </action>
  <verify>
    Run `grep "case 'subscription.canceled'" backend/src/routes/webhooks.ts` to confirm the fix. Also run `npm test -- backend/test/unit/webhook-handler.test.ts` to ensure webhook tests pass. Verify the file no longer contains 'subscription.cancelled' by running: `grep -n "subscription.cancelled" backend/src/routes/webhooks.ts` (should return no results).
  </verify>
  <done>
    Line 126 of webhooks.ts now uses `subscription.canceled` (single L), and cancellation webhooks trigger the handleSubscriptionCancellation handler which deactivates oversights.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update docs/v1/endpoints/webhooks.md</name>
  <files>docs/v1/endpoints/webhooks.md</files>
  <action>
    Find all occurrences of `subscription.cancelled` (double L) and replace with `subscription.canceled` (single L).

    Use find-and-replace to update the event name throughout the documentation file. This ensures developers reference the correct event name in webhook documentation.

    Example: If the file contains `subscription.cancelled` in webhook examples or descriptions, change to `subscription.canceled`.
  </action>
  <verify>
    Run `grep -n "subscription.canceled" "docs/v1/endpoints/webhooks.md"` to confirm the correct spelling is present. Run `grep -n "subscription.cancelled" "docs/v1/endpoints/webhooks.md"` to confirm the incorrect spelling is removed (should return no results).
  </verify>
  <done>
    docs/v1/endpoints/webhooks.md now uses `subscription.canceled` (single L) consistently throughout the document.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update docs/v1/endpoints/subscriptions.md</name>
  <files>docs/v1/endpoints/subscriptions.md</files>
  <action>
    Find all occurrences of `subscription.cancelled` (double L) and replace with `subscription.canceled` (single L).

    Use find-and-replace to update the event name throughout the documentation file. This ensures developers reference the correct event name in subscription documentation.

    Example: If the file contains `subscription.cancelled` in event descriptions or code examples, change to `subscription.canceled`.
  </action>
  <verify>
    Run `grep -n "subscription.canceled" "docs/v1/endpoints/subscriptions.md"` to confirm the correct spelling is present. Run `grep -n "subscription.cancelled" "docs/v1/endpoints/subscriptions.md"` to confirm the incorrect spelling is removed (should return no results).
  </verify>
  <done>
    docs/v1/endpoints/subscriptions.md now uses `subscription.canceled` (single L) consistently throughout the document.
  </done>
</task>

<task type="auto">
  <name>Task 4: Update docs/v1/test scenarios/subscription.md</name>
  <files>docs/v1/test scenarios/subscription.md</files>
  <action>
    Find all occurrences of `subscription.cancelled` (double L) and replace with `subscription.canceled` (single L).

    Use find-and-replace to update the event name throughout the test scenarios file. This ensures test scenarios reference the correct Paddle event name.

    Example: If the file contains `subscription.cancelled` in test case descriptions or expected webhook payloads, change to `subscription.canceled`.
  </action>
  <verify>
    Run `grep -n "subscription.canceled" "docs/v1/test scenarios/subscription.md"` to confirm the correct spelling is present. Run `grep -n "subscription.cancelled" "docs/v1/test scenarios/subscription.md"` to confirm the incorrect spelling is removed (should return no results).
  </verify>
  <done>
    docs/v1/test scenarios/subscription.md now uses `subscription.canceled` (single L) consistently throughout the document.
  </done>
</task>

<task type="auto">
  <name>Task 5: Update docs/v1/requirements/overseer/user-stories.md</name>
  <files>docs/v1/requirements/overseer/user-stories.md</files>
  <action>
    Find all occurrences of `subscription.cancelled` (double L) and replace with `subscription.canceled` (single L).

    Use find-and-replace to update the event name throughout the user stories file. This ensures requirements and user stories reference the correct Paddle event name.

    Example: If the file contains `subscription.cancelled` in user story descriptions or acceptance criteria, change to `subscription.canceled`.
  </action>
  <verify>
    Run `grep -n "subscription.canceled" "docs/v1/requirements/overseer/user-stories.md"` to confirm the correct spelling is present. Run `grep -n "subscription.cancelled" "docs/v1/requirements/overseer/user-stories.md"` to confirm the incorrect spelling is removed (should return no results).
  </verify>
  <done>
    docs/v1/requirements/overseer/user-stories.md now uses `subscription.canceled` (single L) consistently throughout the document.
  </done>
</task>

</tasks>

<verification>
After completion, verify:
1. The case statement for cancellation uses `subscription.canceled` (single L)
2. No occurrences of `subscription.cancelled` (double L) remain in webhooks.ts
3. All documentation files use `subscription.canceled` consistently
4. No occurrences of `subscription.cancelled` (double L) remain in any documentation files
5. Unit tests for webhook handlers pass
6. The handleSubscriptionCancellation function is called for cancellation events
</verification>

<success_criteria>
- Event name changed from `subscription.cancelled` to `subscription.canceled` in code
- Cancellation webhooks are now processed (not just logged)
- Oversights are deactivated when subscription is canceled
- All documentation files updated with correct spelling
- No `subscription.cancelled` (double L) remains in any modified files
- Tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-paddle-webhook-bugfix/09-02-SUMMARY.md`
</output>
