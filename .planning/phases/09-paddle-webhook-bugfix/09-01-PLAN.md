---
phase: 09-paddle-webhook-bugfix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [backend/src/redacted/webhook-security.ts]
autonomous: true

must_haves:
  truths:
    - "Paddle webhooks now pass signature verification"
    - "Signature verification uses colon (:) not period (.)"
    - "No 'Invalid Paddle signature' errors for valid webhooks"
  artifacts:
    - path: "backend/src/redacted/webhook-security.ts"
      provides: "Correct Paddle signature verification"
      contains: "const dataToSign = `${timestamp}:${payload}`"
  key_links:
    - from: "backend/src/routes/webhooks.ts"
      to: "backend/src/redacted/webhook-security.ts"
      via: "validateWebhook middleware"
      pattern: "verifyPaddleSignature"
---

<objective>
Fix the critical signature delimiter bug that causes ALL Paddle webhooks to fail signature verification.

Purpose: This is Priority 1 - the signature delimiter bug prevents ALL webhooks from being processed. Without this fix, no payment events, subscription updates, or cancellations will be handled correctly. The current implementation uses a period (.) instead of a colon (:) between timestamp and payload, which causes the computed signature to never match what Paddle sends.

Output: Corrected signature verification in webhook-security.ts that validates webhooks according to Paddle's specification.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/phases/09-paddle-webhook-bugfix/09-RESEARCH.md

@backend/src/redacted/webhook-security.ts
@backend/src/routes/webhooks.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix signature delimiter in webhook-security.ts</name>
  <files>backend/src/redacted/webhook-security.ts</files>
  <action>
    Change line 354 from:
    ```typescript
    const dataToSign = `${timestamp}.${payload}`;
    ```
    
    To:
    ```typescript
    const dataToSign = `${timestamp}:${payload}`;
    ```
    
    This fixes the critical bug where all webhooks fail signature verification. The colon (:) is the correct delimiter per Paddle's official documentation: https://developer.paddle.com/webhooks/signature-verification
    
    Do NOT change anything else in this file. The timestamp validation, constant-time comparison, and h1=/v1= support are all correct.
  </action>
  <verify>
    Run `npm test -- backend/test/unit/webhook-security.test.ts` to ensure signature verification tests pass with valid Paddle webhooks. Also verify the line contains `${timestamp}:${payload}` not `${timestamp}.${payload}` by running: `grep "const dataToSign" backend/src/redacted/webhook-security.ts`
  </verify>
  <done>
    Line 354 of webhook-security.ts now uses colon (:) delimiter, and signature verification works for valid Paddle webhooks without "Invalid signature" errors.
  </done>
</task>

</tasks>

<verification>
After completion, verify:
1. Signature verification now accepts valid Paddle webhooks with h1= signature format
2. The line `const dataToSign = \`timestamp}:${payload}\`` exists in webhook-security.ts
3. Unit tests for signature verification pass
4. No changes were made to other parts of webhook-security.ts
</verification>

<success_criteria>
- Paddle webhooks pass signature verification
- Signature delimiter changed from period (.) to colon (:)
- No other modifications to webhook-security.ts
- Tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-paddle-webhook-bugfix/09-01-SUMMARY.md`
</output>
