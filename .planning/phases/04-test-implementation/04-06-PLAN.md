---
phase: 04-test-implementation
plan: 06
type: execute
wave: 3
depends_on: []
files_modified:
  - test/e2e/registration-flow.spec.ts
  - test/e2e/subscription-flow.spec.ts
  - test/e2e/oauth-flow.spec.ts
  - test/e2e/playwright.config.ts
autonomous: true
user_setup:
  - service: paddle
    why: "E2E tests use real Paddle sandbox for realistic payment flow"
    env_vars:
      - name: PADDLE_API_KEY
        source: "Paddle Dashboard -> Developers -> API keys"
      - name: PADDLE_VENDOR_ID
        source: "Paddle Dashboard -> Account Settings"

must_haves:
  truths:
    - "E2E tests cover complete user flows"
    - "Registration → subscription → OAuth flow works end-to-end"
    - "Tests use real Paddle sandbox as per user decision"
    - "Chromium browser is used as per user decision"
  artifacts:
    - path: "test/e2e/registration-flow.spec.ts"
      provides: "E2E tests for user registration"
      min_lines: 100
    - path: "test/e2e/subscription-flow.spec.ts"
      provides: "E2E tests for subscription flow"
      min_lines: 100
    - path: "test/e2e/oauth-flow.spec.ts"
      provides: "E2E tests for OAuth flow"
      min_lines: 100
    - path: "test/e2e/playwright.config.ts"
      provides: "Playwright configuration for E2E tests"
      min_lines: 40
  key_links:
    - from: "test/e2e/"
      to: "frontend:5173"
      via: "Playwright browser automation"
      pattern: "page.goto|click|fill"
    - from: "test/e2e/"
      to: "backend:8788"
      via: "Real API calls"
      pattern: "api/.*register|api/.*login"
---

<objective>
Write end-to-end tests covering complete user flows using Playwright with Chromium.

Purpose: Test full user journeys from registration through subscription to OAuth in a real browser.
Output: E2E test files in test/e2e/ directory
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@frontend/src/pages/OverseerAuth.tsx
@frontend/src/pages/SubscriptionManagement.tsx
@frontend/src/pages/RegisteredClients.tsx
@test/manual-console/playwright.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up E2E test infrastructure</name>
  <files>test/e2e/playwright.config.ts</files>
  <action>
    Create test/e2e/ directory and playwright.config.ts.
    
    Per user decision:
    - Use Playwright for E2E testing
    - Use Chromium browser only
    - Use real Paddle sandbox for realistic payment flow
    
    Configure:
    - Base URL for frontend (localhost:5173)
    - Backend API URL (localhost:8788)
    - Chromium only (projects configuration)
    - Trace on failure for debugging
    - Retries for flaky tests
    - Timeout configuration
  </action>
  <verify>Playwright config is valid, can run `npx playwright test --list`</verify>
  <done>E2E test infrastructure is configured</done>
</task>

<task type="auto">
  <name>Task 2: Create registration E2E tests</name>
  <files>test/e2e/registration-flow.spec.ts</files>
  <action>
    Create registration-flow.spec.ts file.
    
    Write E2E tests for:
    - Overseer registration: fills form, submits, receives success
    - Overseer login: with newly registered credentials
    - Agent registration: claims agent, registers with challenge
    - Session persistence: stays logged in on page refresh
    - Logout: clears session correctly
    
    Use real backend API (localhost:8788).
    Clean up test users after each test.
    Use unique email addresses (timestamp-based).
  </action>
  <verify>Run `npx playwright test test/e2e/registration-flow.spec.ts` - tests pass</verify>
  <done>Registration flow is tested end-to-end</done>
</task>

<task type="auto">
  <name>Task 3: Create subscription E2E tests</name>
  <files>test/e2e/subscription-flow.spec.ts</files>
  <action>
    Create subscription-flow.spec.ts file.
    
    Per user decision: E2E tests use real Paddle sandbox.
    
    Write tests for:
    - View subscription status on dashboard
    - Initiate upgrade to BASIC tier (real Paddle checkout)
    - Complete Paddle checkout in sandbox
    - Verify subscription updated after payment
    - View usage statistics
    - Cancel subscription
    
    Use real Paddle checkout (not mock).
    Handle Paddle sandbox test card: use test card 4242 4242 4242 4242.
    Skip if Paddle sandbox not configured (check for API key).
  </action>
  <verify>Run `npx playwright test test/e2e/subscription-flow.spec.ts` - tests pass</verify>
  <done>Subscription flow is tested with real Paddle sandbox</done>
</task>

<task type="auto">
  <name>Task 4: Create OAuth E2E tests</name>
  <files>test/e2e/oauth-flow.spec.ts</files>
  <action>
    Create oauth-flow.spec.ts file.
    
    Write E2E tests for:
    - Register OAuth client: navigate to clients, create new client
    - View client details: shows client_id, redirect_uri
    - Initiate OAuth authorization: generates correct authorization URL
    - Complete OAuth flow: with valid authorization code
    - View registered clients: lists all client's OAuth clients
    
    Use real backend API for OAuth operations.
    Test happy path and error cases (invalid redirect URI, etc.).
  </action>
  <verify>Run `npx playwright test test/e2e/oauth-flow.spec.ts` - tests pass</verify>
  <done>OAuth flow is tested end-to-end</done>
</task>

</tasks>

<verification>
Run all E2E tests with `npx playwright test test/e2e/` and verify:
- Registration flow tests pass
- Subscription flow tests pass (using real Paddle)
- OAuth flow tests pass
</verification>

<success_criteria>
End-to-end Playwright tests cover complete user flows (registration → subscription → OAuth)
</success_criteria>

<output>
After completion, create `.planning/phases/04-test-implementation/04-06-SUMMARY.md`
</output>
