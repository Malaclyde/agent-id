---
phase: 25-frontend-update
plan: 03
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - frontend/src/pages/ShadowClaimPayment.tsx
autonomous: true

must_haves:
  truths:
    - Payment component verifies challenge status on mount
    - Displays payment amount and description
    - Opens Paddle checkout with correct custom data
    - Handles checkout.completed and checkout.closed events
  artifacts:
    - path: frontend/src/pages/ShadowClaimPayment.tsx
      provides: Payment page with Paddle integration
      contains: "Paddle.Initialize|checkout.open"
  key_links:
    - from: ShadowClaimPayment component
      to: api.getChallengeStatus
      via: Function call on mount
      pattern: "getChallengeStatus\\(.*challengeId"
    - from: Paddle checkout
      to: Paddle.js SDK
      via: Paddle.Initialize
      pattern: "Paddle\\.Initialize"
    - from: Checkout event handler
      to: Paddle webhook (for verification)
      via: Paddle event listeners
      pattern: "checkout\\.completed|checkout\\.closed"
---

<objective>
Update ShadowClaimPayment component with Paddle checkout integration.

Purpose: Handle shadow claim payment with proper custom data and success/error states
Output: ShadowClaimPayment component that integrates with Paddle checkout
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/25-frontend-update/25-01-SUMMARY.md

@frontend/src/pages/ShadowClaimPayment.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ShadowClaimPayment component</name>
  <files>frontend/src/pages/ShadowClaimPayment.tsx</files>
  <action>
    Update payment component for new flow:
    
    1. Get challengeId from URL params (use useParams from React Router)
    
    2. On mount:
       - Call api.getChallengeStatus(challengeId)
       - Verify status is 'awaiting-payment'
       - If not, show error and provide option to return to claim page
       - Store challenge data (agent_id, shadow_overseer_id) for checkout
    
    3. Display payment UI:
       - Show amount: $19.00 (hardcoded for now, can pull from env later)
       - Show description: "Shadow Claim - Basic Tier Access"
       - Show "Proceed to Checkout" button
       - Display spinner while verifying challenge status
    
    4. On checkout button click:
       - Open Paddle checkout with Paddle.Checkout.open()
       - Include customData: {
           agent_id: agentId,
           shadow_overseer_id: shadowOverseerId,
           challenge_id: challengeId,
           is_shadow_claim: true
         }
       - Set customer email if available from challenge data
       - Pass priceId from environment variables or challenge data
    
    5. Handle checkout.completed event:
       - Show success message
       - Display "Payment successful! Shadow claim is being processed."
       - Poll for completion status (every 3 seconds)
       - Show success page when status becomes 'completed'
       - Stop polling after 10 seconds of completed status
    
    6. Handle checkout.closed event:
       - If not completed, show "Payment cancelled" message
       - Option to retry payment
       - Option to return to claim page
    
    7. Handle errors:
       - Display error messages from Paddle SDK
       - Show network errors clearly
       - Provide retry option for recoverable errors
       - Provide support contact for unrecoverable errors
    
    8. Initialize Paddle SDK on component mount (if not already initialized globally)
  </action>
  <verify>
    - Payment component loads correctly
    - Challenge verification works
    - Paddle checkout opens with correct custom data
    - Success and error states handled
    - Polling for completion works
    - Checkout event listeners work
  </verify>
  <done>
    ShadowClaimPayment component integrates with Paddle checkout correctly
  </done>
</task>

</tasks>

<verification>
1. Payment component verifies challenge status on mount
2. Payment UI displays amount and description
3. Paddle checkout opens with custom data containing challenge_id
4. checkout.completed event triggers success flow
5. checkout.closed event shows cancellation message
6. Error states handled appropriately
</verification>

<success_criteria>
- ShadowClaimPayment component uses updated API client from plan 01
- Paddle checkout opens with correct custom data
- Payment success/error states handled
- Polling for completion after payment works
- Error messages are user-friendly
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-update/25-03-SUMMARY.md`
</output>
