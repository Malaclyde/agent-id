---
phase: 25-frontend-update
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/App.tsx
  - frontend/src/pages/ShadowClaim.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "App.tsx route parameter name matches domain language (challengeId)"
    - "Frontend transitions to payment UI when status changes to awaiting-payment"
    - "Payment page receives challengeId from URL parameters"
  artifacts:
    - path: frontend/src/App.tsx
      provides: "Route definition with correct parameter name"
      contains: "path=.*challengeId"
    - path: frontend/src/pages/ShadowClaim.tsx
      provides: "Navigation path matching App.tsx route"
      contains: "navigate(/malice/${agentId}/payment/${claimData.challenge_id})"
  key_links:
    - from: frontend/src/pages/ShadowClaim.tsx
      to: frontend/src/App.tsx
      via: "React Router navigate matches route definition"
      pattern: "navigate.*malice.*payment"
    - from: frontend/src/App.tsx
      to: frontend/src/pages/ShadowClaimPayment.tsx
      via: "Route parameter name matches component usage"
      pattern: "challengeId"
---

<objective>
Fix route path mismatch and parameter name inconsistency preventing transition from agent confirmation to payment page.

Purpose: Users encounter 404 error when shadow claim status changes from `initiated` to `awaiting-payment` because navigation path doesn't match defined route.

Output: Updated ShadowClaim.tsx and ShadowClaimPayment.tsx with consistent routing.

Root Cause (from VERIFICATION.md):
- Route path mismatch: ShadowClaim navigates to `/shadow-claim-payment/:agentId/:challengeId` but App.tsx defines `/malice/:agentId/payment/:paymentChallengeId`
- Route parameter name: App.tsx route defines `paymentChallengeId` but component uses `challengeId` (domain language)

Fix approach: Update App.tsx route to use `challengeId` (matching domain language), keep ShadowClaimPayment.tsx using `challengeId` (no change needed there).
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap source
@.planning/phases/25-frontend-update/25-frontend-update-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Fix route path in App.tsx</name>
  <files>frontend/src/App.tsx</files>
  <action>
    Update route definition to match domain language and component expectations:
    
    Current (line ~133):
    <Route path="/malice/:agentId/payment/:paymentChallengeId" element={<ShadowClaimPayment />} />
    
    Change to:
    <Route path="/malice/:agentId/payment/:challengeId" element={<ShadowClaimPayment />} />
    
    This changes the route parameter name from `paymentChallengeId` to `challengeId` to:
    1. Match the domain language used everywhere (challenge_id, challengeId)
    2. Align with what ShadowClaimPayment component expects (useParams<{ challengeId: string }>)
    
    No changes needed to ShadowClaimPayment.tsx - it already correctly uses `challengeId`.
  </action>
  <verify>
    grep -n "Route.*malice.*payment.*challengeId" frontend/src/App.tsx
    Expected: 1 match with `:challengeId` parameter
  </verify>
  <done>
    App.tsx route updated to use `:challengeId` parameter name
  </done>
</task>

<task type="auto">
  <name>Fix navigation path in ShadowClaim.tsx</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
    Update navigation paths from `/shadow-claim-payment/${agentId}/${claimData.challenge_id}` to `/malice/${agentId}/payment/${claimData.challenge_id}` at two locations:
    
    1. Line ~154 (within retryWithBackoff function):
       Change: navigate(`/shadow-claim-payment/${agentId}/${claimData.challenge_id}`);
       To: navigate(`/malice/${agentId}/payment/${claimData.challenge_id}`);
    
    2. Line ~184 (within useEffect polling interval):
       Change: navigate(`/shadow-claim-payment/${agentId}/${claimData.challenge_id}`);
       To: navigate(`/malice/${agentId}/payment/${claimData.challenge_id}`);
    
    This aligns navigation with the updated route in App.tsx which now uses `:challengeId` parameter.
  </action>
  <verify>
    grep -n "navigate.*malice.*payment" frontend/src/pages/ShadowClaim.tsx
    Expected: 2 matches at lines ~154 and ~184
  </verify>
  <done>
    Navigation paths updated to use `/malice/${agentId}/payment/${claimData.challenge_id}` at both retry and polling locations
  </done>
</task>

<task type="auto">
  <name>Verify TypeScript compilation</name>
  <files>frontend/src</files>
  <action>
    Run TypeScript compiler to verify no errors after changes:
    
    cd frontend && npm run type-check
    
    If type-check script doesn't exist, use:
    cd frontend && npx tsc --noEmit
    
    This ensures route parameter name change is type-safe and component still receives correct parameter.
  </action>
  <verify>
    TypeScript compiler completes with no errors
  </verify>
  <done>
    Frontend compiles without TypeScript errors
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Route in App.tsx uses correct parameter name:
   grep -n "Route.*malice.*payment" frontend/src/App.tsx
   Should show `:challengeId` parameter (not `paymentChallengeId`)

2. Navigation paths in ShadowClaim.tsx use correct pattern:
   grep -n "navigate.*malice.*payment" frontend/src/pages/ShadowClaim.tsx
   Should show 2 matches

3. TypeScript compilation succeeds:
   cd frontend && npm run type-check
</verification>

<success_criteria>
- App.tsx route uses `:challengeId` parameter (matching domain language)
- ShadowClaim.tsx navigates to `/malice/{agentId}/payment/{challengeId}` in both retry and polling locations
- Frontend compiles without TypeScript errors
- No new console errors introduced
- Navigation from agent confirmation to payment page succeeds without 404 errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-update/25-05-SUMMARY.md`
</output>
