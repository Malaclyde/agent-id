---
phase: 25-frontend-update
plan: 02
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - frontend/src/pages/ShadowClaim.tsx
autonomous: true

must_haves:
  truths:
    - ShadowClaim component initializes claim on mount
    - Polls for challenge status every 2 seconds
    - Transitions to payment page when status is awaiting-payment
    - Handles completed, expired, and error states
  artifacts:
    - path: frontend/src/pages/ShadowClaim.tsx
      provides: Shadow claim page with state management
      contains: "useState.*status|useEffect.*polling"
  key_links:
    - from: ShadowClaim component
      to: api.initiateShadowClaim
      via: Function call on mount
      pattern: "initiateShadowClaim\\("
    - from: ShadowClaim component
      to: api.getChallengeStatus
      via: setInterval polling
      pattern: "setInterval.*getChallengeStatus|getChallengeStatus.*2000"
    - from: ShadowClaim component
      to: /shadow-claim-payment/:challengeId
      via: React Router navigation
      pattern: "navigate.*payment"
---

<objective>
Update ShadowClaim component with polling and state management.

Purpose: Handle shadow claim lifecycle from initiation to payment transition
Output: ShadowClaim component that polls backend and navigates to payment when ready
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/25-frontend-update/25-01-SUMMARY.md

@frontend/src/pages/ShadowClaim.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ShadowClaim component for new flow</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
    Refactor ShadowClaim.tsx to support new flow:
    
    1. Update component state:
       - Add challengeId state (from API response, not URL param)
       - Add status state: 'loading' | 'initiated' | 'awaiting-payment' | 'completed' | 'expired' | 'error'
       - Keep shadowId state
    
    2. On mount:
       - Call api.initiateShadowClaim(agentId) to get challengeId
       - Store challengeId in state
       - Start polling for status
    
    3. Polling logic:
       - Every 2 seconds: call api.getChallengeStatus(challengeId)
       - Update status state based on response
       - Stop polling when status is 'completed', 'expired', or 'error'
       - When status becomes 'awaiting-payment', navigate to payment page
       - Clean up interval on unmount
    
    4. Render different UI based on status:
       - 'loading': Show spinner with "Initializing..."
       - 'initiated': Show placeholder "Agent confirmation required" (full UI in plan 04)
       - 'awaiting-payment': Navigate to payment page
       - 'completed': Show success message "Claim completed successfully"
       - 'expired': Show expiration message "This claim challenge has expired"
       - 'error': Show error message
    
    5. Remove old polling logic that looked for payment challenges
    
    6. Handle React StrictMode double-invocation properly (use ref to track initialization)
    
    7. Use navigate from React Router to transition to payment page
  </action>
  <verify>
    - Component compiles without TypeScript errors
    - Polling implemented correctly
    - All status states handled
    - Cleanup on unmount works
    - Navigation to payment page works
  </verify>
  <done>
    ShadowClaim component polls for status and navigates to payment when ready
  </done>
</task>

</tasks>

<verification>
1. Component initializes claim on mount
2. Polling runs every 2 seconds
3. Navigation to payment page triggers on awaiting-payment status
4. Polling stops on completed/expired/error states
5. Cleanup on unmount verified
</verification>

<success_criteria>
- ShadowClaim component uses updated API client from plan 01
- Polling logic implemented correctly
- All status states handled
- Navigation to payment page works
- Component handles React StrictMode correctly
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-update/25-02-SUMMARY.md`
</output>
