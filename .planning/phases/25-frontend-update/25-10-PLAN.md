---
phase: 25-frontend-update
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/api/client.ts
  - frontend/src/pages/ShadowClaim.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Direct URL access shows correct shadow overseer ID (not undefined)"
    - "Polling uses exponential backoff (not fixed 2000ms)"
    - "Manual 'Check Status' button enables user-initiated polling"
  artifacts:
    - path: "frontend/src/api/client.ts"
      provides: "ShadowClaimResponse interface with correct field name"
      contains: "shadow_overseer_id: string"
    - path: "frontend/src/pages/ShadowClaim.tsx"
      provides: "Shadow claim UI with proper polling and manual check button"
      contains: "exponential backoff, Check Status button"
---

<objective>
Fix API client field name mismatch and improve polling behavior.
</objective>

<context>
@.planning/phases/25-frontend-update/25-UAT.md

Gap: Backend returns `shadow_overseer_id` but frontend API client declares `shadow_id` in ShadowClaimResponse interface. TypeScript drops unknown properties, causing 'undefined' to display.
</context>

<tasks>

<task type="auto">
  <name>Fix ShadowClaimResponse interface field name</name>
  <files>frontend/src/api/client.ts</files>
  <action>
1. In the `ShadowClaimResponse` interface (lines 11-16), change `shadow_id: string;` to `shadow_overseer_id: string;`

2. In ShadowClaim.tsx, update the interface at lines 10-14 to match:
   - Change `shadow_id: string;` to `shadow_overseer_id: string;`

3. Update all references in ShadowClaim.tsx:
   - Line 692: `handleCopy(JSON.stringify({ overseer_id: claimData?.shadow_id }, ...)` → change to `claimData?.shadow_overseer_id`
   - Line 720: Display `{claimData?.shadow_id}` → change to `{claimData?.shadow_overseer_id}`
  </action>
  <verify>
- Run `npm run build` or `npx tsc --noEmit` in frontend directory
- Verify no TypeScript errors about unknown properties
  </verify>
  <done>
- ShadowClaimResponse uses `shadow_overseer_id` field name
- Display shows actual overseer ID (not "undefined")
  </done>
</task>

<task type="auto">
  <name>Implement exponential backoff polling</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
In the polling useEffect (lines 169-201), replace the fixed 2000ms interval with exponential backoff:

1. Add state for current poll interval: `const [pollInterval, setPollInterval] = useState(2000);`

2. Replace the fixed `setInterval` with recursive setTimeout that increases delay:
   - Start at 2000ms
   - After each poll: `setPollInterval(prev => Math.min(prev * 1.5, 30000))` (max 30 seconds)
   - Reset to 2000ms when status changes (navigates to payment)

3. Use the dynamic interval in the polling function:
   ```typescript
   const pollTimeout = setTimeout(async () => {
     // ... poll logic
     poll();
   }, pollInterval);
   ```

4. Clean up with `clearTimeout(pollTimeout)` in the effect cleanup
  </action>
  <verify>
- Check that polling interval increases over time (not fixed 2s)
- Max interval should be capped at 30 seconds
  </verify>
  <done>
- Polling starts at 2s, increases by 1.5x each poll, caps at 30s
- Interval resets when user clicks "Check Status" or on status change
  </done>
</task>

<task type="auto">
  <name>Add manual Check Status button</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
Add a "Check Status" button to allow manual polling in addition to automatic polling:

1. Add a "Check Status" button near the countdown timer or waiting indicator
2. The button should:
   - Trigger immediate status check (similar to the polling logic)
   - Reset the exponential backoff interval to 2000ms
   - Show brief loading state while checking
3. Style the button with CSS classes (not inline styles) matching the project theme
4. Button text: "Check Status" with a refresh icon

Example placement: In the waiting indicator section (around line 750), add button before or after the "Waiting for agent..." message
  </verify>
  <verify>
- Button appears in the UI
- Clicking button triggers immediate status check
- Polling interval resets after manual check
  </verify>
  <done>
- "Check Status" button visible to user
- Manual check works alongside automatic polling
  </done>
</task>

</tasks>

<verification>
- Frontend builds without TypeScript errors
- Direct URL access shows correct shadow_overseer_id
- Polling uses exponential backoff (not fixed interval)
- Manual Check Status button is functional
</verification>

<success_criteria>
- Test 2 passes: Direct URL access shows correct overseer ID
- No 'undefined' displayed for overseer ID
- Polling is not too aggressive (uses backoff)
- User can manually check status
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-update/25-10-SUMMARY.md`
</output>
