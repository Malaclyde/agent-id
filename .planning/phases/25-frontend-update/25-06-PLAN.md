---
phase: 25-frontend-update
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/api/client.ts
  - frontend/src/pages/ShadowClaim.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Direct URL access displays correct shadow overseer ID"
    - "Polling uses exponential backoff (2s → 4s → 8s → max 30s)"
    - "Manual 'Check Status' button allows manual polling"
  artifacts:
    - path: "frontend/src/api/client.ts"
      provides: "ShadowClaimResponse interface with correct field name"
      fix: "Change shadow_id to shadow_overseer_id"
    - path: "frontend/src/pages/ShadowClaim.tsx"
      provides: "Exponential backoff polling + manual check button"
  key_links:
    - from: "ShadowClaim.tsx"
      to: "api.initiateShadowClaim"
      via: "response.shadow_overseer_id"
---

<objective>
Fix API client field mismatch and improve polling with exponential backoff and manual trigger.

Purpose: Fix the root cause of undefined overseer ID and aggressive polling
Output: API client returns correct data, polling is user-friendly
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/25-frontend-update/25-UAT.md
# Gap: Test 2 - Direct URL access

The displayed overseer id is 'undefined' - this should be the correct shadow overseer id. 
Also the polling is too aggressive - make sure to exponentially increase the time before the next poll, 
add a 'check status' button to the page that would enable manual polling.

Root cause: Backend returns `shadow_overseer_id` but frontend API client declares `shadow_id` in ShadowClaimResponse interface.
</context>

<tasks>

<task type="auto">
  <name>Fix API client field name</name>
  <files>frontend/src/api/client.ts</files>
  <action>
    In the ShadowClaimResponse interface (lines 11-16), change `shadow_id: string` to `shadow_overseer_id: string`.
    
    Also update any references in the same file that use this field name.
  </action>
  <verify>TypeScript compiles without errors. The interface now has shadow_overseer_id field.</verify>
  <done>API client interface correctly declares shadow_overseer_id field</done>
</task>

<task type="auto">
  <name>Update ShadowClaim component field reference</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
    In the ShadowClaimData interface (lines 10-14), change `shadow_id: string` to `shadow_overseer_id: string`.
    
    Update all references to claimData?.shadow_id to claimData?.shadow_overseer_id throughout the file:
    - Line 692: handleCopy uses claimData?.shadow_id in JSON string
    - Line 720: Display uses claimData?.shadow_id
  </action>
  <verify>TypeScript compiles without errors. Copy button now copies correct JSON with overseer_id.</verify>
  <done>ShadowClaim component correctly references shadow_overseer_id</done>
</task>

<task type="auto">
  <name>Add exponential backoff to polling</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
    In the polling useEffect (lines 169-201), replace the fixed 2000ms interval with exponential backoff:
    
    1. Add a pollingIntervalRef to track current interval
    2. Start at 2000ms, double each poll: 2000 → 4000 → 8000 → 16000 → max 30000
    3. Reset backoff when component mounts or on manual check
    4. Clear interval on status change to 'completed', 'expired', or 'error'
  </action>
  <verify>Console logs show increasing intervals between polls. No TypeScript errors.</verify>
  <done>Polling uses exponential backoff up to 30 seconds</done>
</task>

<task type="auto">
  <name>Add manual Check Status button</name>
  <files>frontend/src/pages/ShadowClaim.tsx</files>
  <action>
    Add a "Check Status" button to the main UI (near the countdown timer or instructions section):
    
    1. Add state: const [isManualPolling, setIsManualPolling] = useState(false)
    2. Create handleManualCheck function that:
       - Resets polling backoff to 2000ms
       - Immediately fetches status
       - Updates UI accordingly
    3. Add button with lucide-react Refresh icon
    4. Button should be disabled while isManualPolling is true
  </action>
  <verify>Button appears in UI, clicking triggers immediate status check, TypeScript compiles.</verify>
  <done>Manual Check Status button allows user-triggered polling</done>
</task>

</tasks>

<verification>
1. Run `cd frontend && npm run build` - should complete without errors
2. Verify API response field shadow_overseer_id is correctly captured
3. Verify polling interval increases over time (check console logs)
4. Verify Check Status button is visible and functional
</verification>

<success_criteria>
- shadow_overseer_id displays correctly (not undefined)
- Polling interval increases exponentially
- Manual Check Status button works
</success_criteria>

<output>
After completion, create `.planning/phases/25-frontend-update/25-06-SUMMARY.md`
</output>
