---
phase: 07-update-outdated-docs
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "All [OUTDATED] subscription docs rewritten for Paddle integration"
    - "agent_claim_procedure.md [PARTIAL] tag resolved"
    - "No [OUTDATED] or [PARTIAL] tags remain in docs/v1/"
  artifacts:
    - path: "docs/v1/flows/subscription/subscription-flows.md"
      provides: "Current checkout and webhook flow documentation"
      min_lines: 50
    - path: "docs/v1/flows/subscription/subscription-endpoints.md"
      provides: "Current subscription API endpoints"
      min_lines: 50
    - path: "docs/v1/requirements/subscription/subscription-model.md"
      provides: "Paddle API-based storage model"
      min_lines: 30
    - path: "docs/v1/flows/agent/agent_claim_procedure.md"
      provides: "Complete claim procedure with oversights table"
      min_lines: 50
  key_links: []
---

<objective>
Update 4 documentation files that were marked [OUTDATED] or [PARTIAL] in Phase 1 audit.

Purpose: Ensure all subscription and agent claim documentation accurately reflects the current Paddle integration implementation.

Output: 4 updated documentation files with no outdated markers remaining.
</objective>

<execution_context>
@./.planning/phases/07-update-outdated-docs/07-CONTEXT.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase Context (locked decisions):**
- Structure & format: Follow Phase 1 documentation templates exactly
- Content depth: Include both conceptual explanations AND API reference details
- Verification: Scan codebase to verify accuracy
- Goal: No outdated information remains in docs/v1/

**Key implementation facts (from prior phases):**
- Paddle is single source of truth for subscription data (not local DB)
- Webhook endpoint: single /webhooks/paddle
- Agent claims use oversights table (not owned_by column)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite subscription-flows.md</name>
  <files>docs/v1/flows/subscription/subscription-flows.md</files>
  <action>
Rewrite docs/v1/flows/subscription/subscription-flows.md:

1. Remove [OUTDATED] banner
2. Document current Paddle integration:
   - Checkout flow: how users subscribe (Paddle Checkout)
   - Webhook flow: how subscription events are processed (/webhooks/paddle)
   - Current event types: subscription_created, subscription_updated, subscription_canceled
3. Reference actual implementation in backend/src/routes/webhooks/paddle.ts
4. Follow Phase 1 template format
</action>
  <verify>
[OUTDATED] banner removed, current Paddle flow documented
  </verify>
  <done>
subscription-flows.md updated to reflect current Paddle integration
</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite subscription-endpoints.md</name>
  <files>docs/v1/flows/subscription/subscription-endpoints.md</files>
  <action>
Rewrite docs/v1/flows/subscription/subscription-endpoints.md:

1. Remove [OUTDATED] banner
2. Document current subscription endpoints from backend/src/routes/subscriptions.ts:
   - GET /subscriptions - List subscriptions (if exists)
   - POST /subscriptions/checkout - Create checkout session
   - GET /subscriptions/:id - Get subscription details
   - DELETE /subscriptions/:id - Cancel subscription
3. Include request/response schemas
4. Follow Phase 1 endpoint documentation format
</action>
  <verify>
[OUTDATED] banner removed, all 4 endpoints documented with correct paths
  </verify>
  <done>
subscription-endpoints.md updated with current API endpoints
</done>
</task>

<task type="auto">
  <name>Task 3: Rewrite subscription-model.md</name>
  <files>docs/v1/requirements/subscription/subscription-model.md</files>
  <action>
Rewrite docs/v1/requirements/subscription/subscription-model.md:

1. Remove [OUTDATED] banner
2. Document that subscription data is stored in Paddle (not local DB)
3. Explain: overseers table stores paddle_customer_id and paddle_subscription_id
4. Document: /me endpoint queries Paddle API for current subscription status
5. Reference Phase 3 fixes (Paddle as single source of truth)
</action>
  <verify>
[OUTDATED] banner removed, Paddle-as-source-of-truth documented
  </verify>
  <done>
subscription-model.md updated to reflect Paddle API storage
</done>
</task>

<task type="auto">
  <name>Task 4: Fix agent_claim_procedure.md [PARTIAL] tag</name>
  <files>docs/v1/flows/agent/agent_claim_procedure.md</files>
  <action>
Fix docs/v1/flows/agent/agent_claim_procedure.md:

1. Remove [PARTIAL] banner
2. Clarify: Agent claims use oversights table (not owned_by column)
3. Document oversight relationships:
   - Each agent can have one active oversight per overseer
   - oversights table links agent_id to overseer_id
   - Tier determined by overseer's subscription (via Paddle)
4. Reference actual implementation in backend/src/services/ownership.ts and oversights.ts
</action>
  <verify>
[PARTIAL] banner removed, oversights table relationship fully documented
  </verify>
  <done>
agent_claim_procedure.md updated with complete oversights documentation
</done>
</task>

<task type="auto">
  <name>Task 5: Verify no outdated markers remain</name>
  <files></files>
  <action>
Run grep to verify no [OUTDATED] or [PARTIAL] markers remain in docs/v1/:

```bash
grep -r "\[OUTDATED\]" docs/v1/ || echo "No OUTDATED markers found"
grep -r "\[PARTIAL\]" docs/v1/ || echo "No PARTIAL markers found"
```

If any remain, fix them.
</action>
  <verify>
grep returns no matches for [OUTDATED] or [PARTIAL]
  </verify>
  <done>
All documentation markers cleaned up - docs/v1/ is current
</done>
</task>

</tasks>

<verification>
Phase completion checklist:
- [x] subscription-flows.md updated for Paddle
- [x] subscription-endpoints.md with current API
- [x] subscription-model.md with Paddle storage
- [x] agent_claim_procedure.md [PARTIAL] resolved
- [x] No [OUTDATED] or [PARTIAL] markers remain
</verification>

<success_criteria>
All 5 DOC-UPDATE requirements satisfied:
1. subscription-flows.md rewritten for Paddle ✓
2. subscription-endpoints.md lists 4 endpoints ✓
3. subscription-model.md explains Paddle storage ✓
4. agent_claim_procedure.md [PARTIAL] resolved ✓
5. No outdated markers remain ✓
</success_criteria>

<output>
After completion, create `.planning/phases/07-update-outdated-docs/07-01-SUMMARY.md`
</output>
