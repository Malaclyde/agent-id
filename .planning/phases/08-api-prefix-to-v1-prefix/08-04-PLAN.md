---
phase: 08-api-prefix-to-v1-prefix
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/test/unit/api/client.test.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Frontend unit test uses /v1/test instead of /api/test"
    - "All test expectations match /v1/* API paths"
  artifacts:
    - path: "frontend/test/unit/api/client.test.ts"
      contains: "'/v1/test'"
      not_contains: "'/api/test'"
  key_links: []
---

<objective>
Fix unit test API paths to use /v1 prefix

Purpose: Ensure unit test consistency with the /v1 API migration completed in plans 08-01 and 08-02
Output: Unit test file using /v1/test paths instead of /api/test paths
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-api-prefix-to-v1-prefix/08-CONTEXT.md
@.planning/phases/08-api-prefix-to-v1-prefix/08-02-SUMMARY.md
@.planning/phases/08-api-prefix-to-v1-prefix/08-VERIFICATION.md

Gap source: 08-VERIFICATION.md - "Frontend unit tests and integration test utilities still use /api/* paths"
</context>

<tasks>

<task type="auto">
  <name>Fix unit test API paths to use /v1 prefix</name>
  <files>frontend/test/unit/api/client.test.ts</files>
  <action>
  Replace all occurrences of '/api/test' with '/v1/test' in the unit test file:
  
  - Line 111: Change await expect((api as any).request('/api/test')).rejects.toThrow('Test error')
    to await expect((api as any).request('/v1/test')).rejects.toThrow('Test error')
  
  - Line 121: Change const result = await (api as any).request('/api/test');
    to const result = await (api as any).request('/v1/test');
  
  This ensures unit test expectations match the /v1 API paths used by the frontend client.
  
  Reference: Plan 08-02 updated frontend/src/api/client.ts to use /v1/* paths for all 27 endpoints.
  Gap reason: "Frontend unit tests and integration test utilities still use /api/* paths"
  </action>
  <verify>
    grep -n "'/api/test'" frontend/test/unit/api/client.test.ts 2>&1
    Expected output: No matches
    
    grep -n "'/v1/test'" frontend/test/unit/api/client.test.ts 2>&1
    Expected output: 2 matches (lines 111 and 121)
  </verify>
  <done>Unit test uses /v1/test path in all test cases, consistent with frontend API client</done>
</task>

</tasks>

<verification>
After completion, run:
```bash
# Verify no /api/test paths remain
grep "'/api/test'" frontend/test/unit/api/client.test.ts
# Expected: No matches

# Verify /v1/test paths are used
grep "'/v1/test'" frontend/test/unit/api/client.test.ts
# Expected: 2 matches
```
</verification>

<success_criteria>
All generic test paths in client.test.ts use /v1/test instead of /api/test
</success_criteria>

<output>
After completion, create `.planning/phases/08-api-prefix-to-v1-prefix/08-04-SUMMARY.md`
</output>
