---
phase: 08-api-prefix-to-v1-prefix
plan: 02
type: execute
wave: 2
depends_on:
  - 08-01
files_modified:
  - frontend/src/api/client.ts
  - frontend/vite.config.ts
  - frontend/test/unit/api/client.test.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Frontend API client uses /v1/* paths for all endpoints"
    - "Frontend proxy configuration updated for /v1 paths"
  artifacts:
    - path: "frontend/src/api/client.ts"
      provides: "Frontend API client with /v1 paths"
      contains: "/v1/"
  key_links:
    - from: "frontend/src/api/client.ts"
      to: "backend/src/index.ts"
      via: "fetch calls to /v1/* paths"
---

<objective>
Update frontend API client to use new /v1/* prefix paths.

Purpose: Frontend must call the new /v1 endpoints after backend migration.
Output: Updated frontend/src/api/client.ts with all endpoint paths changed from /api/* to /v1/*
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@frontend/src/api/client.ts

All API paths in client.ts need to change from /api/* to /v1/*

Current paths that need updating:
- /api/agents/register -> /v1/agents/register
- /api/agents/login -> /v1/agents/login
- /api/agents/complete-login -> /v1/agents/complete-login
- /api/agents/me -> /v1/agents/me
- /api/agents/me/oauth-history -> /v1/agents/me/oauth-history
- /api/overseers/register -> /v1/overseers/register
- /api/overseers/login -> /v1/overseers/login
- /api/overseers/me -> /v1/overseers/me
- /api/overseers/me/agents -> /v1/overseers/me/agents
- /api/agents/claim/initiate -> /v1/agents/claim/initiate
- /api/agents/claim/status/:challengeId -> /v1/agents/claim/status/:challengeId
- /api/agents/declaim/:agentId -> /v1/agents/declaim/:agentId
- /api/overseers/logout -> /v1/overseers/logout
- /api/agents/claim/complete/:challengeId -> /v1/agents/claim/complete/:challengeId
- /api/overseers/agents/:agentId/block-client -> /v1/overseers/agents/:agentId/block-client
- /api/overseers/agents/:agentId/block-client/:clientId -> /v1/overseers/agents/:agentId/block-client/:clientId
- /api/overseers/agents/:agentId/blocked-clients -> /v1/overseers/agents/:agentId/blocked-clients
- /api/clients/register/:ownerType -> /v1/clients/register/:ownerType
- /api/clients/list/:ownerType -> /v1/clients/list/:ownerType
- /api/clients/:clientId/key -> /v1/clients/:clientId/key
- /api/clients/:clientId -> /v1/clients/:clientId
- /api/subscriptions/me -> /v1/subscriptions/me
- /api/subscriptions/tiers -> /v1/subscriptions/tiers
- /api/subscriptions/upgrade -> /v1/subscriptions/upgrade
- /api/subscriptions/usage -> /v1/subscriptions/usage
- /api/agents/malice/:agentId -> /v1/agents/malice/:agentId
- /api/agents/malice/payment/status/:paymentChallengeId -> /v1/agents/malie/payment/status/:paymentChallengeId
</context>

<tasks>

<task type="auto">
  <name>Task 2: Update frontend API client paths</name>
  <files>frontend/src/api/client.ts</files>
  <action>
    Update all API endpoint paths in frontend/src/api/client.ts from /api/* to /v1/*

    Using replaceAll, replace all occurrences of:
    - "/api/agents" → "/v1/agents"
    - "/api/overseers" → "/v1/overseers"  
    - "/api/clients" → "/v1/clients"
    - "/api/subscriptions" → "/v1/subscriptions"

    This is a simple string replacement across the entire file.
  </action>
  <verify>
    Verify no /api/ paths remain (except in comments):
    grep -n '"/api/' frontend/src/api/client.ts
  </verify>
  <done>
    All API paths use /v1/ prefix
  </done>
</task>

<task type="auto">
  <name>Task 3: Update frontend test file paths</name>
  <files>frontend/test/unit/api/client.test.ts</files>
  <action>
    Update all API endpoint paths in frontend/test/unit/api/client.test.ts from /api/* to /v1/*

    The test file has mock expectations that check which URLs are called. Update these to /v1/* paths.

    Replace all occurrences of:
    - "/api/agents" → "/v1/agents"
    - "/api/overseers" → "/v1/overseers"  
    - "/api/clients" → "/v1/clients"
    - "/api/subscriptions" → "/v1/subscriptions"

    Note: The test at '/api/test' is a generic test path - leave as '/api/test' or update to '/v1/test' for consistency.
  </action>
  <verify>
    Verify no /api/ paths remain in test expectations
  </verify>
  <done>
    All test expectations use /v1/ prefix
  </done>
</task>

<task type="auto">
  <name>Task 3: Update frontend vite.config.ts proxy</name>
  <files>frontend/vite.config.ts</files>
  <action>
    Check frontend/vite.config.ts for proxy configuration. Update /api/* proxy configs to /v1/*.

    Add /oauth proxy configuration to map /oauth to backend's /v1/oauth route:
    '/oauth': { target: 'http://localhost:8787', changeOrigin: true }

    Note: The /oauth proxy configuration added here will be removed in gap closure plan 08-06 once verification confirms it's unused (frontend API client uses /v1/clients/* for OAuth operations).
  </action>
  <verify>
    Verify /oauth proxy is configured
  </verify>
  <done>
    Proxy configuration aligned with /v1 paths, /oauth proxy added
  </done>
</task>

</tasks>

<verification>
- Run: grep -n '"/api/' frontend/src/api/client.ts
- Should return no matches (only comments)
- Check vite.config.ts proxy settings
</verification>

<success_criteria>
Frontend API client uses /v1/* for all endpoints
</success_criteria>

<output>
After completion, create `.planning/phases/08-api-prefix-to-v1-prefix/08-02-SUMMARY.md`
</output>
