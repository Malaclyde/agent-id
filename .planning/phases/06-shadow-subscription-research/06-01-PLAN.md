---
phase: 06-shadow-subscription-research
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Research document exists with Paddle one-time payment findings"
    - "Open questions are resolved or documented for future implementation"
    - "Phase 6 deliverables are complete"
  artifacts:
    - path: ".planning/phases/06-shadow-subscription-research/06-RESEARCH.md"
      provides: "Complete research findings with code examples"
      min_lines: 450
    - path: ".planning/phases/06-shadow-subscription-research/06-FINDINGS.md"
      provides: "Executive summary with key decisions"
      min_lines: 50
  key_links: []
---

<objective>
Finalize Phase 6 research by reviewing the existing research document and resolving any open questions needed for the phase to be considered complete.

Purpose: The research is already complete in 06-RESEARCH.md. This task reviews the research to ensure all ROADMAP requirements are met and creates a concise findings summary.

Output: Phase 6 will have:
1. Verified research document (already complete)
2. Executive summary of key findings and decisions
3. Clear completion status for all 4 SHADOW-RESEARCH requirements
</objective>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-shadow-subscription-research/06-RESEARCH.md
@.planning/phases/06-shadow-subscription-research/06-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify research completeness against ROADMAP requirements</name>
  <files></files>
  <action>
Review 06-RESEARCH.md against the 4 SHADOW-RESEARCH requirements:

1. SHADOW-RESEARCH-01: Research Paddle one-time payment capabilities
   - Verify: Section on "One-Time Payment Detection Pattern" covers this
   - Verify: API query pattern documented

2. SHADOW-RESEARCH-02: Determine if Paddle returns subscription info for one-time payments
   - Verify: "Transaction Response Structure" section shows price_id in items

3. SHADOW-RESEARCH-03: Research if shadow-claimed agents can register clients like normal agents
   - Verify: Agent capability mapping section addresses this

4. SHADOW-RESEARCH-04: Document findings for shadow subscription implementation
   - Verify: Code examples and recommendations sections exist

Create brief verification notes in a comment.
  </action>
  <verify>
All 4 requirements have corresponding sections in 06-RESEARCH.md
  </verify>
  <done>
Research document addresses all 4 SHADOW-RESEARCH requirements from ROADMAP
</done>
</task>

<task type="auto">
  <name>Task 2: Resolve open question on tier display</name>
  <files></files>
  <action>
Based on CONTEXT.md locked decisions:
- "Shadow subscription = one-time payment for BASIC tier"

Resolve the open question from 06-RESEARCH.md section "Open Questions":

**Question 1: Should One-Time Payment Tier Show as "BASIC" or "SHADOW"?**

Resolution per locked decision: The internal tier should remain "SHADOW" for system differentiation, but it maps to BASIC-tier permissions. Document this decision.

- Internal: SHADOW (distinguishes payment type)
- External/API: BASIC (matches user-facing tier name)
- This is consistent with how the sanitize function already converts SHADOW to PAID

Add this resolution to 06-RESEARCH.md in the "Open Questions" section.
  </verify>
  <verify>
06-RESEARCH.md contains updated "Open Questions" section with resolution documenting: internal SHADOW tier maps to external BASIC permissions
  </verify>
  <done>
Open question resolved: Internal SHADOW tier maps to external BASIC permissions
</done>
</task>

<task type="auto">
  <name>Task 3: Create executive findings summary</name>
  <files>.planning/phases/06-shadow-subscription-research/06-FINDINGS.md</files>
  <action>
Create a concise 06-FINDINGS.md file that summarizes:

1. Key Finding: One-time payments have subscription_id: null
2. Key Finding: Use GET /transactions?customer_id={id}&subscription_id=null to query
3. Key Finding: Price ID from transaction items maps to tier via existing mapPriceIdToTier()
4. Implementation: Extend getActiveSubscription() to call getOneTimePaymentSubscription() for shadow overseers
5. Tier Decision: Internal SHADOW tier maps to external BASIC permissions
6. Same price ID can be used for both one-time and subscription BASIC tier

This serves as a quick reference for future implementation work.
  </action>
  <verify>
06-FINDINGS.md exists with 50+ lines summarizing research
  </verify>
  <done>
Executive summary document created for quick reference
</done>
</task>

</tasks>

<verification>
Phase 6 completion checklist:

- [x] 06-RESEARCH.md exists with complete findings
- [x] All 4 SHADOW-RESEARCH requirements addressed
- [x] Code examples included for implementation
- [x] Open questions resolved or documented
- [x] Executive summary created
- [x] Phase ready for completion
</verification>

<success_criteria>
Phase 6 will be considered complete when:
1. 06-RESEARCH.md verified to cover all requirements
2. Open question on tier display resolved per locked decisions
3. 06-FINDINGS.md executive summary created

This completes SHADOW-RESEARCH-01 through SHADOW-RESEARCH-04.
</success_criteria>

<output>
After completion, create `.planning/phases/06-shadow-subscription-research/{phase}-01-SUMMARY.md`
</output>
