---
phase: 28-audit-test-strategy
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/v1/flows/subscription/subscription-endpoints.md
  - docs/v1/flows/subscription/subscription-flows.md
  - docs/v1/flows/client/client_app_register_workflow.md
autonomous: true
must_haves:
  truths:
    - Subscription and client flows are fully documented with Mermaid diagrams.
    - Paddle subscription edge cases (upgrades, downgrades, cancellations, failures) are explicitly listed.
  artifacts:
    - path: docs/v1/flows/subscription/subscription-flows.md
      provides: "Detailed API trace for Paddle subscriptions"
      contains: "Edge Cases"
    - path: docs/v1/flows/client/client_app_register_workflow.md
      provides: "Detailed API trace for Client Registration"
      contains: "Edge Cases"
  key_links: []
---

<objective>
Audit and formalize the subscription and client registration flows in the documentation.

Purpose: To ensure we fully map Paddle integration states and subscription edge cases before writing testing strategy.
Output: Standardized flow markdown files with Quick Glance, Mermaid sequence diagrams, and Detailed API Traces.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-*/28-CONTEXT.md
@.planning/phases/28-*/28-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and Rewrite Subscription Flows</name>
  <files>docs/v1/flows/subscription/subscription-endpoints.md, docs/v1/flows/subscription/subscription-flows.md</files>
  <action>
    Read the existing documentation in `docs/v1/flows/subscription/` and cross-reference with `backend/src/services/paddle-api.ts` and `backend/src/services/subscription.ts`.
    Important: The codebase uses Paddle, not Stripe (ignore any Stripe references in RESEARCH.md).
    Rewrite both files to match the new strict format:
    1. Quick Glance
    2. Sequence Diagram (using mermaid)
    3. Detailed API Trace (Endpoint, Request/Response Payload)
    Explicitly list Paddle subscription edge cases under "Edge Cases": upgrades, downgrades, cancellations, resumes, payment failures, and interactions when an overseer resumes a subscription.
  </action>
  <verify>
    cat "docs/v1/flows/subscription/subscription-flows.md" | grep -i "Edge Cases" && cat "docs/v1/flows/subscription/subscription-flows.md" | grep "mermaid"
  </verify>
  <done>
    Subscription flows accurately map Paddle interactions and edge cases.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit and Rewrite Client App Workflow</name>
  <files>docs/v1/flows/client/client_app_register_workflow.md</files>
  <action>
    Read the file and any relevant `backend/src/services/oauth-client.ts` or `client-limits.ts` code.
    Rewrite the file to the new strict format:
    1. Quick Glance
    2. Sequence Diagram (using mermaid)
    3. Detailed API Trace
    List client registration and limit-related edge cases under "Edge Cases".
  </action>
  <verify>
    cat "docs/v1/flows/client/client_app_register_workflow.md" | grep -i "Edge Cases" && cat "docs/v1/flows/client/client_app_register_workflow.md" | grep "mermaid"
  </verify>
  <done>
    Client app registration flow conforms to standard format with edge cases detailed.
  </done>
</task>

</tasks>

<verification>
grep -r "Edge Cases" docs/v1/flows/subscription/ docs/v1/flows/client/
grep -r "mermaid" docs/v1/flows/subscription/ docs/v1/flows/client/
</verification>

<success_criteria>
All subscription and client registration flow documents are upgraded to include Mermaid diagrams and explicit, detailed edge case lists.
</success_criteria>

<output>
After completion, create `.planning/phases/28-audit-test-strategy/28-02-SUMMARY.md`
</output>