---
phase: 30-frontend-test-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/test/unit/setup.ts
  - frontend/test/mocks/server.ts
  - frontend/test/mocks/browser.ts
autonomous: true
must_haves:
  truths:
    - "Developer can install msw package via npm"
    - "MSW server is created and exported for tests to use"
    - "Test setup file initializes MSW server before all tests"
  artifacts:
    - path: "frontend/package.json"
      provides: "MSW dependency"
      contains: '"msw"'
    - path: "frontend/test/mocks/server.ts"
      provides: "MSW Node server for unit tests"
      exports: ["server"]
    - path: "frontend/test/unit/setup.ts"
      provides: "Test initialization"
      contains: "beforeAll"
  key_links:
    - from: "frontend/test/unit/setup.ts"
      to: "frontend/test/mocks/server.ts"
      via: "import { server }"
      pattern: "server.listen"
---

<objective>
Install MSW (Mock Service Worker) and create the foundational test infrastructure that all component tests will use for API mocking.

Purpose: MSW enables realistic API mocking without vi.mock, allowing tests to verify HTTP interactions naturally. This is the foundation for all frontend tests.
Output: MSW installed, server setup created, test initialization updated.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing test setup
@frontend/test/unit/setup.ts
@frontend/test/unit/vitest.config.ts
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Install MSW and initialize</name>
  <files>frontend/package.json</files>
  <action>
    Install MSW package:
    ```bash
    cd frontend && npm install -D msw
    ```
    
    Initialize MSW for browser (creates service worker):
    ```bash
    cd frontend && npx msw init public/ --save
    ```
    
    DO NOT run `npx msw init public/` if the public/ directory doesn't exist - create it first or skip browser worker initialization since unit tests use Node server.
  </action>
  <verify>`cd frontend && npm ls msw` shows installed version</verify>
  <done>MSW package appears in devDependencies of frontend/package.json</done>
</task>

<task type="auto">
  <name>Create MSW server setup</name>
  <files>frontend/test/mocks/server.ts</files>
  <action>
    Create MSW Node server for unit tests:
    
    ```typescript
    // frontend/test/mocks/server.ts
    import { setupServer } from 'msw/node';
    import { handlers } from './handlers';
    
    export const server = setupServer(...handlers);
    ```
    
    Create placeholder handlers file:
    ```typescript
    // frontend/test/mocks/handlers.ts
    import { http, HttpResponse } from 'msw';
    
    // Placeholder - no default handlers
    // Tests should define their own responses via server.use()
    export const handlers: any[] = [];
    ```
    
    Key decision from CONTEXT.md: No default success handlers. Each test defines its own responses via `server.use()`.
  </action>
  <verify>File exists and exports `server` from 'msw/node'</verify>
  <done>frontend/test/mocks/server.ts exports setupServer, handlers.ts exists with empty array</done>
</task>

<task type="auto">
  <name>Update test setup to initialize MSW</name>
  <files>frontend/test/unit/setup.ts</files>
  <action>
    Update the existing setup.ts to:
    1. Import the MSW server
    2. Start server before all tests
    3. Reset handlers after each test
    4. Close server after all tests
    
    Add to existing setup.ts:
    ```typescript
    import { server } from '../mocks/server';
    
    // Start MSW server before all tests
    beforeAll(() => server.listen({ onUnhandledRequest: 'error' }));
    
    // Reset handlers after each test
    afterEach(() => server.resetHandlers());
    
    // Close server after all tests
    afterAll(() => server.close());
    ```
    
    Keep existing mocks (localStorage, sessionStorage, fetch, crypto, React Router) - they can coexist with MSW.
  </action>
  <verify>`cd frontend && npm run test:unit -- --run` passes with no errors (existing tests still pass)</verify>
  <done>MSW server lifecycle managed in test setup, existing tests still pass</done>
</task>

</tasks>

<verification>
1. MSW installed in frontend/package.json devDependencies
2. frontend/test/mocks/server.ts exports setupServer
3. frontend/test/mocks/handlers.ts exists with empty handlers array
4. frontend/test/unit/setup.ts imports and manages MSW server lifecycle
5. Existing unit tests still pass: `cd frontend && npm run test:unit`
</verification>

<success_criteria>
- MSW package installed and listed in devDependencies
- Server setup created with empty handlers (tests define own responses)
- Test setup initializes MSW server with proper lifecycle
- All existing unit tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-test-implementation/30-01-SUMMARY.md`
</output>
