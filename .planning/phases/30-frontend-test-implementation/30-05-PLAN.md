---
phase: 30-frontend-test-implementation
plan: 05
type: execute
wave: 3
depends_on: [30-01, 30-02, 30-03, 30-04]
files_modified:
  - frontend/test/unit/pages/home.test.tsx
  - frontend/test/unit/components/header.test.tsx
autonomous: true
must_haves:
  truths:
    - "Developer can run tests for Home page that verify human/agent flow selection"
    - "Developer can run tests for Header component that verify auth state display"
    - "Tests use MSW handlers instead of vi.mock for API calls"
  artifacts:
    - path: "frontend/test/unit/pages/home.test.tsx"
      provides: "Home page tests"
      contains: "describe('Home'"
    - path: "frontend/test/unit/components/header.test.tsx"
      provides: "Header component tests"
      contains: "describe('Header'"
  key_links:
    - from: "frontend/test/unit/pages/home.test.tsx"
      to: "frontend/test/utils/render-helpers.tsx"
      via: "import renderWithRouter"
      pattern: "renderWithRouter"
---

<objective>
Update existing Home and Header tests to use MSW and render helpers, ensuring they follow the new testing patterns.

Purpose: Establish consistent test patterns early. These simple component tests serve as templates for more complex tests.
Output: Updated tests using MSW and render helpers with comprehensive coverage.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing tests to update
@frontend/test/unit/pages/home.test.tsx
@frontend/test/unit/components/header.test.tsx

# Components being tested
@frontend/src/pages/Home.tsx
@frontend/src/components/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Update Home page tests with MSW pattern</name>
  <files>frontend/test/unit/pages/home.test.tsx</files>
  <action>
    Update existing tests to use render helpers. The Home page doesn't make API calls, so MSW isn't needed, but use the render helpers for consistency.
    
    Key changes:
    1. Import from render-helpers instead of direct testing-library imports
    2. Use renderWithRouter instead of custom wrapper function
    3. Add tests for navigation state (human vs agent view)
    4. Ensure all existing tests still pass
    
    Review the existing test file and update imports. Keep the test structure but improve coverage:
    - Test initial render with title and buttons
    - Test human flow selection and view
    - Test agent flow selection and view
    - Test navigation links
    - Test back button functionality
    
    DO NOT remove existing tests - just update them to use render helpers.
  </action>
  <verify>`cd frontend && npm run test:unit -- --run test/unit/pages/home.test.tsx` passes</verify>
  <done>Home tests updated with render helpers, all existing tests pass</done>
</task>

<task type="auto">
  <name>Update Header component tests with MSW pattern</name>
  <files>frontend/test/unit/components/header.test.tsx</files>
  <action>
    Update existing Header tests to use MSW for API mocking and render helpers.
    
    Review existing test file and:
    1. Use renderWithAuth or renderWithAllProviders from render-helpers
    2. Use MSW handlers for /v1/overseers/me or /v1/agents/me endpoints
    3. Add tests for:
       - Unauthenticated state (shows login link)
       - Authenticated overseer state (shows email, logout)
       - Authenticated agent state (shows agent info)
       - Logout functionality
    
    Example pattern:
    ```typescript
    import { describe, it, expect, beforeEach, vi } from 'vitest';
    import { screen, fireEvent, waitFor } from '@testing-library/react';
    import { server } from '../../mocks/server';
    import { http, HttpResponse } from 'msw';
    import { renderWithAllProviders } from '../../utils/render-helpers';
    import { mockAuthenticatedOverseer } from '../../utils/auth-helpers';
    import { createMockOverseer } from '../../factories';
    import Header from '../../../src/components/Header';
    
    describe('Header', () => {
      beforeEach(() => {
        vi.clearAllMocks();
        server.resetHandlers();
      });
      
      it('shows login link when not authenticated', async () => {
        mockUnauthenticated();
        renderWithAllProviders(<Header />);
        
        await waitFor(() => {
          expect(screen.getByText('Login')).toBeInTheDocument();
        });
      });
      
      // ... more tests
    });
    ```
  </action>
  <verify>`cd frontend && npm run test:unit -- --run test/unit/components/header.test.tsx` passes</verify>
  <done>Header tests updated with MSW, tests cover authenticated/unauthenticated states</done>
</task>

</tasks>

<verification>
1. Both test files use render helpers from test/utils/render-helpers.tsx
2. Header tests use MSW handlers for API mocking
3. All tests pass: `cd frontend && npm run test:unit`
4. Test coverage includes all major UI states
</verification>

<success_criteria>
- Home tests use renderWithRouter, cover human/agent flow selection
- Header tests use MSW for API mocking, cover auth state display
- Both test files follow consistent patterns for other tests to follow
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-test-implementation/30-05-SUMMARY.md`
</output>