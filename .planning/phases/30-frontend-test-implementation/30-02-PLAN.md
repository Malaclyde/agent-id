---
phase: 30-frontend-test-implementation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/test/factories/agent.ts
  - frontend/test/factories/overseer.ts
  - frontend/test/factories/subscription.ts
  - frontend/test/factories/client.ts
  - frontend/test/factories/index.ts
  - frontend/test/builders/test-state.ts
autonomous: true
must_haves:
  truths:
    - "Developer can import createMockAgent to generate test agent data"
    - "Developer can import createMockOverseer to generate test overseer data"
    - "Developer can import createMockSubscription to generate test subscription data"
    - "Developer can use TestStateBuilder to compose complex test scenarios"
  artifacts:
    - path: "frontend/test/factories/index.ts"
      provides: "All factory exports"
      exports: ["createMockAgent", "createMockOverseer", "createMockSubscription", "createMockClient"]
    - path: "frontend/test/builders/test-state.ts"
      provides: "Complex scenario builder"
      exports: ["TestStateBuilder"]
  key_links:
    - from: "frontend/test/factories/index.ts"
      to: "frontend/test/factories/*.ts"
      via: "re-export"
      pattern: "export \\* from"
---

<objective>
Create test data factories and builders for generating consistent mock data across all frontend tests.

Purpose: Factories provide type-safe, consistent mock data. Builders enable complex test scenarios (e.g., agent with overseer relationship). Reduces boilerplate in tests.
Output: Factory functions for all domain entities and a TestStateBuilder for complex scenarios.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Domain types for factories
@frontend/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Create entity factories</name>
  <files>frontend/test/factories/agent.ts, frontend/test/factories/overseer.ts, frontend/test/factories/subscription.ts, frontend/test/factories/client.ts, frontend/test/factories/index.ts</files>
  <action>
    Create factory directory and files:
    
    **frontend/test/factories/agent.ts:**
    ```typescript
    import type { Agent } from '../../src/types';
    
    export function createMockAgent(overrides: Partial<Agent> = {}): Agent {
      return {
        id: 'agent-' + Math.random().toString(36).substr(2, 9),
        name: 'Test Agent',
        description: 'A test agent',
        oauth_count: 0,
        billing_period_end: null,
        ...overrides,
      };
    }
    ```
    
    **frontend/test/factories/overseer.ts:**
    ```typescript
    import type { Overseer } from '../../src/types';
    
    export function createMockOverseer(overrides: Partial<Overseer> = {}): Overseer {
      return {
        id: 'overseer-' + Math.random().toString(36).substr(2, 9),
        name: 'Test Overseer',
        email: 'test@example.com',
        created_at: new Date().toISOString(),
        ...overrides,
      };
    }
    ```
    
    **frontend/test/factories/subscription.ts:**
    ```typescript
    import type { Subscription, SubscriptionTier, SubscriptionUsage } from '../../src/types';
    
    export function createMockSubscription(overrides: Partial<Subscription> = {}): Subscription {
      return {
        tier: 'FREE',
        status: 'active',
        is_active: true,
        will_renew: true,
        max_agents: 1,
        max_clients: 2,
        max_oauth_per_period: 10,
        billing_period_end: null,
        grace_period_end: null,
        scheduled_cancel_at: null,
        ...overrides,
      };
    }
    
    export function createMockSubscriptionTier(overrides: Partial<SubscriptionTier> = {}): SubscriptionTier {
      return {
        tier: 'FREE',
        price: 0,
        max_agents: 1,
        max_clients: 2,
        max_oauth_per_period: 10,
        ...overrides,
      };
    }
    
    export function createMockSubscriptionUsage(overrides: Partial<SubscriptionUsage> = {}): SubscriptionUsage {
      return {
        agents_claimed: 0,
        clients_registered: 0,
        oauth_count: 0,
        ...overrides,
      };
    }
    ```
    
    **frontend/test/factories/client.ts:**
    ```typescript
    export interface MockOAuthClient {
      id: string;
      name: string;
      redirect_uris: string[];
      scope: string | null;
      created_at: string;
    }
    
    export function createMockOAuthClient(overrides: Partial<MockOAuthClient> = {}): MockOAuthClient {
      return {
        id: 'client-' + Math.random().toString(36).substr(2, 9),
        name: 'Test Client',
        redirect_uris: ['http://localhost:3000/callback'],
        scope: 'read write',
        created_at: new Date().toISOString(),
        ...overrides,
      };
    }
    ```
    
    **frontend/test/factories/index.ts:**
    ```typescript
    export * from './agent';
    export * from './overseer';
    export * from './subscription';
    export * from './client';
    ```
    
    Check frontend/src/types/index.ts for actual type definitions to ensure alignment.
  </action>
  <verify>All factory files exist and export their functions; index.ts re-exports all</verify>
  <done>All 4 factory files created with type-safe mock functions, index.ts exports all</done>
</task>

<task type="auto">
  <name>Create TestStateBuilder for complex scenarios</name>
  <files>frontend/test/builders/test-state.ts</files>
  <action>
    Create a fluent builder for complex test scenarios:
    
    ```typescript
    // frontend/test/builders/test-state.ts
    import { createMockAgent, createMockOverseer, createMockSubscription, createMockSubscriptionUsage } from '../factories';
    import type { Agent, Overseer, Subscription, SubscriptionUsage } from '../../src/types';
    
    export interface TestState {
      agent: Agent | null;
      overseer: Overseer | null;
      subscription: Subscription | null;
      usage: SubscriptionUsage | null;
      sessionId: string | null;
      authType: 'agent' | 'overseer' | null;
    }
    
    export class TestStateBuilder {
      private state: TestState = {
        agent: null,
        overseer: null,
        subscription: null,
        usage: null,
        sessionId: null,
        authType: null,
      };
    
      withAgent(overrides: Partial<Agent> = {}): this {
        this.state.agent = createMockAgent(overrides);
        return this;
      }
    
      withOverseer(overrides: Partial<Overseer> = {}): this {
        this.state.overseer = createMockOverseer(overrides);
        return this;
      }
    
      withSubscription(overrides: Partial<Subscription> = {}): this {
        this.state.subscription = createMockSubscription(overrides);
        return this;
      }
    
      withUsage(overrides: Partial<SubscriptionUsage> = {}): this {
        this.state.usage = createMockSubscriptionUsage(overrides);
        return this;
      }
    
      asAgent(sessionId: string = 'test-session'): this {
        this.state.authType = 'agent';
        this.state.sessionId = sessionId;
        if (!this.state.agent) {
          this.state.agent = createMockAgent();
        }
        return this;
      }
    
      asOverseer(sessionId: string = 'test-session'): this {
        this.state.authType = 'overseer';
        this.state.sessionId = sessionId;
        if (!this.state.overseer) {
          this.state.overseer = createMockOverseer();
        }
        return this;
      }
    
      withAgentOwnedBy(overseerId: string): this {
        if (!this.state.agent) {
          this.state.agent = createMockAgent();
        }
        // Agent would need overseer_id field - adjust based on actual types
        return this;
      }
    
      build(): TestState {
        return { ...this.state };
      }
    
      // Convenience methods for common scenarios
      static agentDashboard(): TestState {
        return new TestStateBuilder()
          .asAgent()
          .withSubscription({ tier: 'FREE' })
          .withUsage()
          .build();
      }
    
      static overseerDashboard(): TestState {
        return new TestStateBuilder()
          .asOverseer()
          .withSubscription({ tier: 'FREE' })
          .withUsage()
          .build();
      }
    
      static premiumAgent(): TestState {
        return new TestStateBuilder()
          .asAgent()
          .withSubscription({ tier: 'PRO', is_active: true })
          .withUsage()
          .build();
      }
    }
    ```
  </action>
  <verify>File exists and exports TestStateBuilder class with fluent API methods</verify>
  <done>TestStateBuilder created with fluent methods: withAgent, withOverseer, withSubscription, asAgent, asOverseer, build, and static convenience methods</done>
</task>

</tasks>

<verification>
1. All factory files exist: agent.ts, overseer.ts, subscription.ts, client.ts
2. index.ts re-exports all factory functions
3. TestStateBuilder exists with fluent API
4. Types align with frontend/src/types/index.ts
</verification>

<success_criteria>
- Factory functions create type-safe mock data for Agent, Overseer, Subscription, SubscriptionTier, SubscriptionUsage, OAuthClient
- TestStateBuilder provides fluent API for composing test scenarios
- Static convenience methods exist for common scenarios (agentDashboard, overseerDashboard, premiumAgent)
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-test-implementation/30-02-SUMMARY.md`
</output>
