---
phase: 30-frontend-test-implementation
plan: 03
type: execute
wave: 2
depends_on: [30-01]
files_modified:
  - frontend/test/mocks/handlers/agents.ts
  - frontend/test/mocks/handlers/overseers.ts
  - frontend/test/mocks/handlers/clients.ts
  - frontend/test/mocks/handlers/subscriptions.ts
  - frontend/test/mocks/handlers.ts
autonomous: true
must_haves:
  truths:
    - "Developer can import agentHandlers to mock /v1/agents/* endpoints"
    - "Developer can import overseerHandlers to mock /v1/overseers/* endpoints"
    - "Developer can import clientHandlers to mock /v1/clients/* endpoints"
    - "Developer can import subscriptionHandlers to mock /v1/subscriptions/* endpoints"
  artifacts:
    - path: "frontend/test/mocks/handlers/agents.ts"
      provides: "Agent endpoint handlers"
      exports: ["agentHandlers"]
    - path: "frontend/test/mocks/handlers/overseers.ts"
      provides: "Overseer endpoint handlers"
      exports: ["overseerHandlers"]
    - path: "frontend/test/mocks/handlers/clients.ts"
      provides: "Client endpoint handlers"
      exports: ["clientHandlers"]
    - path: "frontend/test/mocks/handlers/subscriptions.ts"
      provides: "Subscription endpoint handlers"
      exports: ["subscriptionHandlers"]
  key_links:
    - from: "frontend/test/mocks/handlers.ts"
      to: "frontend/test/mocks/handlers/*.ts"
      via: "import and re-export"
      pattern: "export \\* from"
---

<objective>
Create MSW handlers organized by endpoint domain. Each handler file exports request handlers for its domain's API endpoints.

Purpose: Organized handlers make it easy for tests to mock specific API responses. Tests use `server.use()` to override handlers for specific scenarios.
Output: Handler files for agents, overseers, clients, and subscriptions.
</objective>

<execution_context>
./.opencode/get-shit-done/workflows/execute-plan.md
./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# API client to understand endpoints
@frontend/src/api/client.ts
</context>

<tasks>

<task type="auto">
  <name>Create agent endpoint handlers</name>
  <files>frontend/test/mocks/handlers/agents.ts</files>
  <action>
    Create handlers directory and agent handlers file.
    
    **frontend/test/mocks/handlers/agents.ts:**
    ```typescript
    import { http, HttpResponse } from 'msw';
    
    const API_BASE = '';
    
    // Default handlers return errors - tests should override with server.use()
    export const agentHandlers = [
      // Agent registration
      http.post(`${API_BASE}/v1/agents/register`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured - use server.use() to override' },
          { status: 500 }
        );
      }),
      
      // Agent login
      http.post(`${API_BASE}/v1/agents/login`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Complete agent login
      http.post(`${API_BASE}/v1/agents/complete-login`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get agent me
      http.get(`${API_BASE}/v1/agents/me`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get agent OAuth history
      http.get(`${API_BASE}/v1/agents/me/oauth-history`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Initiate agent claim
      http.post(`${API_BASE}/v1/agents/claim/initiate`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Claim agent status
      http.get(`${API_BASE}/v1/agents/claim/status/:challengeId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Complete agent claim
      http.post(`${API_BASE}/v1/agents/claim/complete/:challengeId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Declaim agent
      http.post(`${API_BASE}/v1/agents/declaim/:agentId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Shadow claim endpoints
      http.post(`${API_BASE}/v1/agents/malice/:agentId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      http.get(`${API_BASE}/v1/agents/malice/status/:challengeId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
    ];
    ```
    
    Key principle: All handlers return 500 errors by default. Tests MUST use `server.use()` to override with specific responses. This catches unmocked endpoints.
  </action>
  <verify>File exists with http handlers for all /v1/agents/* endpoints</verify>
  <done>agentHandlers array contains handlers for register, login, complete-login, me, oauth-history, claim/*, declaim, malice/*</done>
</task>

<task type="auto">
  <name>Create overseer endpoint handlers</name>
  <files>frontend/test/mocks/handlers/overseers.ts</files>
  <action>
    **frontend/test/mocks/handlers/overseers.ts:**
    ```typescript
    import { http, HttpResponse } from 'msw';
    
    const API_BASE = '';
    
    export const overseerHandlers = [
      // Register overseer
      http.post(`${API_BASE}/v1/overseers/register`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured - use server.use() to override' },
          { status: 500 }
        );
      }),
      
      // Login overseer
      http.post(`${API_BASE}/v1/overseers/login`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get overseer me
      http.get(`${API_BASE}/v1/overseers/me`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get overseer agents
      http.get(`${API_BASE}/v1/overseers/me/agents`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Logout overseer
      http.post(`${API_BASE}/v1/overseers/logout`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Block client
      http.post(`${API_BASE}/v1/overseers/agents/:agentId/block-client`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Unblock client
      http.delete(`${API_BASE}/v1/overseers/agents/:agentId/block-client/:clientId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get blocked clients
      http.get(`${API_BASE}/v1/overseers/agents/:agentId/blocked-clients`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
    ];
    ```
  </action>
  <verify>File exists with http handlers for all /v1/overseers/* endpoints</verify>
  <done>overseerHandlers array contains handlers for register, login, me, agents, logout, block-client operations</done>
</task>

<task type="auto">
  <name>Create client and subscription handlers</name>
  <files>frontend/test/mocks/handlers/clients.ts, frontend/test/mocks/handlers/subscriptions.ts, frontend/test/mocks/handlers.ts</files>
  <action>
    **frontend/test/mocks/handlers/clients.ts:**
    ```typescript
    import { http, HttpResponse } from 'msw';
    
    const API_BASE = '';
    
    export const clientHandlers = [
      // Register client
      http.post(`${API_BASE}/v1/clients/register/:ownerType`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // List clients
      http.get(`${API_BASE}/v1/clients/list/:ownerType`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Update client key
      http.put(`${API_BASE}/v1/clients/:clientId/key`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Delete client
      http.delete(`${API_BASE}/v1/clients/:clientId`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
    ];
    ```
    
    **frontend/test/mocks/handlers/subscriptions.ts:**
    ```typescript
    import { http, HttpResponse } from 'msw';
    
    const API_BASE = '';
    
    export const subscriptionHandlers = [
      // Get subscription
      http.get(`${API_BASE}/v1/subscriptions/me`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get tiers
      http.get(`${API_BASE}/v1/subscriptions/tiers`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Initiate upgrade
      http.post(`${API_BASE}/v1/subscriptions/upgrade`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Get usage
      http.get(`${API_BASE}/v1/subscriptions/usage`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
      
      // Cancel subscription
      http.post(`${API_BASE}/v1/subscriptions/cancel`, () => {
        return HttpResponse.json(
          { error: 'Mock not configured' },
          { status: 500 }
        );
      }),
    ];
    ```
    
    **Update frontend/test/mocks/handlers.ts:**
    ```typescript
    import { agentHandlers } from './handlers/agents';
    import { overseerHandlers } from './handlers/overseers';
    import { clientHandlers } from './handlers/clients';
    import { subscriptionHandlers } from './handlers/subscriptions';
    
    // Combine all handlers - each returns 500 by default
    // Tests should use server.use() to override specific handlers
    export const handlers = [
      ...agentHandlers,
      ...overseerHandlers,
      ...clientHandlers,
      ...subscriptionHandlers,
    ];
    
    // Re-export for convenience
    export { agentHandlers } from './handlers/agents';
    export { overseerHandlers } from './handlers/overseers';
    export { clientHandlers } from './handlers/clients';
    export { subscriptionHandlers } from './handlers/subscriptions';
    ```
  </action>
  <verify>All handler files exist and are combined in handlers.ts</verify>
  <done>clientHandlers and subscriptionHandlers created, handlers.ts combines all handlers and re-exports</done>
</task>

</tasks>

<verification>
1. All handler files exist in frontend/test/mocks/handlers/
2. Each handler file exports an array of MSW http handlers
3. handlers.ts imports and combines all handlers
4. All /v1/* endpoints from api/client.ts are covered
5. Default responses are 500 errors (tests must override)
</verification>

<success_criteria>
- agentHandlers covers: register, login, complete-login, me, oauth-history, claim/*, declaim, malice/*
- overseerHandlers covers: register, login, me, agents, logout, block-client operations
- clientHandlers covers: register, list, key update, delete
- subscriptionHandlers covers: me, tiers, upgrade, usage, cancel
- All handlers return 500 by default (fail-fast pattern)
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-test-implementation/30-03-SUMMARY.md`
</output>